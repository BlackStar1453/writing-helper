# 管理员界面文档

## 概述

管理员界面提供了完整的转发验证管理功能，只有角色为 `admin` 的用户才能访问。管理员可以查看、审核、批量操作所有用户提交的转发验证记录。

## 功能特性

### 1. 权限控制
- 只有 `role = 'admin'` 的用户才能访问管理员界面
- 非管理员用户访问时会自动重定向到仪表板
- 所有管理员API都有权限验证

### 2. 统计概览
- **总记录数**: 显示所有转发记录总数和今日新增
- **待验证**: 显示待验证记录数和过期记录数
- **已验证**: 显示已通过验证的记录数和本周验证数
- **发放奖励**: 显示总奖励次数，分基础模型和高级模型

### 3. 记录管理
- **列表查看**: 分页显示所有转发记录
- **筛选功能**: 按状态、平台、用户搜索
- **详情查看**: 查看记录详细信息和上传的截图
- **状态管理**: 通过、拒绝、重置记录状态

### 4. 批量操作
- **批量通过**: 一次性通过多条记录
- **批量拒绝**: 一次性拒绝多条记录
- **批量删除**: 删除选中的记录

## 访问方式

### 1. 设置管理员权限

首先需要将用户角色设置为管理员：

```sql
-- 方法1: 通过邮箱设置管理员
UPDATE users 
SET role = 'admin' 
WHERE email = 'your-admin-email@example.com';

-- 方法2: 将第一个用户设置为管理员
UPDATE users 
SET role = 'admin' 
WHERE id = (SELECT id FROM users ORDER BY created_at LIMIT 1);
```

或者使用提供的脚本：
```bash
psql $DATABASE_URL -f scripts/create-admin-user.sql
```

### 2. 访问管理员界面

管理员用户登录后，在仪表板左侧导航栏会看到 "Share Verification Admin" 菜单项。

直接访问路径：`/dashboard/admin/share-verification`

## 界面功能详解

### 统计卡片

界面顶部显示四个统计卡片：

1. **总记录数**
   - 显示所有转发记录的总数
   - 显示今日新增记录数

2. **待验证**
   - 显示当前待验证的记录数
   - 显示过期未验证的记录数（超过24小时）

3. **已验证**
   - 显示已通过验证的记录总数
   - 显示本周验证通过的记录数

4. **发放奖励**
   - 显示总共发放的奖励次数
   - 分别显示基础模型和高级模型的奖励数

### 过期提醒

如果有过期未验证的记录，界面会显示橙色提醒卡片，提示管理员及时处理。

### 筛选和搜索

- **搜索框**: 支持按用户邮箱、姓名或记录ID搜索
- **状态筛选**: 全部状态、待验证、已通过、已拒绝
- **平台筛选**: 全部平台、X (Twitter)、小红书、微博

### 记录列表

每条记录显示：
- 用户信息（邮箱、姓名）
- 平台和状态徽章
- 提交时间、预定验证时间、验证时间
- 奖励信息（数量和类型）
- 操作按钮（查看详情、快速操作）

### 批量操作

选择多条记录后，可以进行：
- **批量通过**: 自动验证并发放奖励
- **批量拒绝**: 将状态设置为已拒绝
- **批量删除**: 从数据库中删除记录

### 记录详情

点击"查看"按钮可以查看记录详情：
- 完整的记录信息
- 用户详细信息
- 时间轴信息
- 上传的截图
- 操作按钮

## API 端点

### 管理员专用API

1. **GET /api/admin/share-verification**
   - 获取转发记录列表
   - 支持分页、筛选、搜索

2. **POST /api/admin/share-verification**
   - 批量操作记录
   - 支持批量通过、拒绝、删除

3. **GET /api/admin/share-verification/stats**
   - 获取统计信息
   - 包含概览、时间统计、平台统计等

4. **GET /api/admin/share-verification/[id]**
   - 获取单个记录详情

5. **PUT /api/admin/share-verification/[id]**
   - 更新单个记录状态
   - 支持通过、拒绝、重置操作

6. **DELETE /api/admin/share-verification/[id]**
   - 删除单个记录

### 权限验证

所有管理员API都会验证：
1. 用户是否已登录
2. 用户角色是否为 `admin`
3. 返回相应的错误状态码（401未登录，403权限不足）

## 操作流程

### 日常管理流程

1. **查看统计**: 了解系统整体状态
2. **处理过期**: 优先处理过期未验证的记录
3. **审核记录**: 查看用户上传的截图，判断是否符合要求
4. **批量操作**: 对符合条件的记录进行批量通过或拒绝

### 审核标准

建议的审核标准：
- 截图清晰，能看到转发和点赞操作
- 转发内容与平台相符
- 没有明显的伪造痕迹
- 用户信息真实有效

### 异常处理

- **过期记录**: 可以直接通过或重置验证时间
- **重复提交**: 检查用户是否在同一平台重复提交
- **异常用户**: 对于频繁提交异常记录的用户，可以拒绝其请求

## 安全考虑

1. **权限隔离**: 管理员功能完全独立，普通用户无法访问
2. **操作日志**: 所有管理员操作都有详细的控制台日志
3. **数据验证**: 所有输入都经过验证和清理
4. **错误处理**: 完善的错误处理和用户友好的错误信息

## 扩展功能

未来可以考虑添加：
1. **操作日志**: 记录管理员的所有操作
2. **用户管理**: 管理用户账户和权限
3. **系统设置**: 配置验证规则和奖励标准
4. **数据导出**: 导出统计报告和记录数据
5. **通知系统**: 向用户发送验证结果通知

## 故障排除

### 常见问题

1. **无法访问管理员界面**
   - 检查用户角色是否为 `admin`
   - 确认已正确登录

2. **统计数据不准确**
   - 刷新页面重新加载数据
   - 检查数据库连接

3. **批量操作失败**
   - 检查选中的记录是否有效
   - 查看控制台错误信息

4. **图片无法显示**
   - 检查图片文件是否存在
   - 确认服务器静态文件配置

### 调试技巧

1. 查看浏览器开发者工具的网络请求
2. 检查服务器控制台日志
3. 使用健康检查端点验证系统状态
4. 直接查询数据库验证数据状态
